# Compendium

English Natural Language Processing for Node.js and the browser.

75k only for the browser package.

Features:

- Tokenization
- Part-of-Speech tagging (scores 90.5% on the Penn Treebank dataset for the minimal version, 92% with the full lexicon).
- Negation/tense/... detection
- Entities extraction
- Sentiment analysis (with smileys!)

MIT licensed.

- [How to use](#how-to-use)
- [API](#api)
- [About the Part-of-Speech tagging](#part-of-speech-tagging)
- [Development](#development)
- [Milestones](#milestones)

## How to use

#### In the browser

With `bower`:

    bower install --save compendium

Otherwise clone this repo and copy the `dist/compendium.minimal.js` file into your project.

Then:

    <!-- Include the lib with the minimal lexicon -->
    <script type="text/javascript" 
        src="path/to/compendium/dist/compendium.minimal.js"></script>
     
    <!-- Use it -->
    <script type="text/javascript">
        console.log(compendium.analyse('Hello world'));
    </script>

#### Node.js

    npm install --save compendium

and then:

    var compendium = require('compendium');
        
    console.log(compendium.analyse('Hello world'));

## API

##### analyse : perform a full analysis

The only function to be called. Take a string as parameter and returns an array containing an analysis for each sentence.

    compendium.analyse('My name is Dr. Jekyll.');

will return an object like:

    [ { time: 5,                        // Time of processing, in ms
        confidence: 0.5,                // PoS tagging confidence
        length: 6,                      // Count of tokens
        raw: 'My name is Dr. Jekyll .', // Raw string
        profile:                        
         { label: 'neutral',            // Sentiment: `negative`, `neutral`, `positive`
           sentiment: 0,                // Sentiment score
           politeness: 0,               // Politeness score
           negated: false },            // Is sentence mainly negated
        entities: [ {                   // List of entities
            raw: 'Dr. Jekyll',          // Raw reconstructed entity
            norm: 'doctor jekyll',      // Normalized entity
            fromIndex: 3,               // Start token index
            toIndex: 4,                 // End token index
            type: null } ],             // Type of entity: null for unknown, `ip`, `email`...
        tags:                           // Array of PoS tags
         [ 'PRP$', 'NN', 'VBZ', 'NNP', 'NNP', '.' ],
        tokens:                         // Tokens details
         [ { raw: 'My',                 // Raw token
            norm: 'my',                 // Normalized
            pos: 'PRP$',                // PoS tag
            profile:                    
             { sentiment: 0,            // Sentiment score
               emphasis: 1,             // Emphasis multiplier
               negated: false,          // Is negated
               breakpoint: false },     // Is breakpoint
            attr:
             { acronym: false,          // Is acronym
               plural: false,           // Is plural
               abbr: false,             // Is an abbreviation
               verb: false } },         // Is a verb
            //
            // ... Other tokens
            //
       ] } ]

##### lex : tokenize a string

Returns a matrix of tokens per sentences.

    compendium.lex (text)

Example:

    compendium.lex('My name is Dr. Jekyll. My cat\'s name is Mr. Hyde.');
    //  [
    //      ['My', 'name', 'is', 'Dr.', 'Jekyll', '.'],
    //      ['My', 'cat', '\'s', 'name', 'is', 'Mr.', 'Hyde', '.']
    //  ]

##### tag : return Part-of-Speech tags from an array of tokens

Returns an array of tags and a confidence into the tagging.

    compendium.tag (tokens)

    compendium.tag(['My', 'name', 'is', 'Dr.', 'Jekyll', '.']);
    //  {
    //      tags: [ 'PRP$', 'NN', 'VBZ', 'NNP', 'NNP', '.' ],
    //      confidence: 1
    //  }

## Part-of-Speech tagging

Tagging is performed using a [Brill tagger](http://en.wikipedia.org/wiki/Eric_Brill) (i.e. a base lexicon and some set of rules), with the addition of some inflexion-based rules.

It takes inspiration from the following projects that are worth being checked out:
- Eric Brill tagger: latest implementation published under MIT license is available for download on Plymouth University [at this link (direct download)](http://www.tech.plym.ac.uk/soc/staff/guidbugm/software/RULE_BASED_TAGGER_V.1.14.tar.Z).
- [Mark Watson's FastTag Java library](https://github.com/mark-watson/fasttag_v2), one of the implementation of Brill's tagger.
- [NLP Compromise](https://github.com/spencermountain/nlp_compromise), another great JS NLP toolkit, with an interesting inflection-based approach

PoS tagging tests are performed both against the [Penn Treebank](http://www.cis.upenn.edu/~treebank/) dataset, and against results generated by the [Stanford PoS tagger](http://nlp.stanford.edu/software/tagger.shtml) ([here is an online API](nlp.stanford.edu:8080/parser/index.jsp)), double checked with common sense and [another](http://nlpdotnet.com/services/Tagger.aspx) tagger fully machine-learning oriented.

#### Lexicons

Full version for Node.js uses the lexicon from Mark Watson's FastTag (around 90 000 terms).

Minimal version for the browser contains only a few thousands terms extracted from the full version, and filtered using:
    - the list of the 10000 most common English words [an extract](https://github.com/first20hours/google-10000-english) from the [Google's Trillion Word Corpus](http://storage.googleapis.com/books/ngrams/books/datasetsv2.html)
    - the list of scored sentiments words. 

#### Tags definition

    , Comma                     ,
    : Mid-sent punct.           : ;
    . Sent-final punct          . ! ?
    " quote                     "
    ( Left paren                (
    ) Right paren               )
    # Pound sign                #
    CC Coord Conjuncn           and,but,or
    CD Cardinal number          one,two,1,2
    CR Currency sign            $,€,£
    DT Determiner               the,some
    EX Existential there        there
    FW Foreign Word             mon dieu
    IN Preposition              of,in,by
    JJ Adjective                big
    JJR Adj., comparative       bigger
    JJS Adj., superlative       biggest
    LS List item marker         1,One
    MD Modal                    can,should
    NN Noun, sing. or mass      dog
    NNP Proper noun, sing.      Edinburgh
    NNPS Proper noun, plural    Smiths
    NNS Noun, plural            dogs
    PDT Predeterminer           all, both
    POS Possessive ending       's
    PP Personal pronoun         I,you,she
    PRP$ Possessive pronoun     my,one's
    RB Adverb                   quickly, not
    RBR Adverb, comparative     faster
    RBS Adverb, superlative     fastest
    RP Particle                 up,off
    SYM Symbol                  +,%,&
    TO 'to'                     to
    UH Interjection             oh, oops
    VB verb, base form          eat
    VBD verb, past tense        ate
    VBG verb, gerund            eating
    VBN verb, past part         eaten
    VBP Verb, present           eat
    VBZ Verb, present           eats
    WDT Wh-determiner           which,that
    WP Wh pronoun               who,what
    WP$ Possessive-Wh           whose
    WRB Wh-adverb               how,where

Compendium also includes the following new tag:

    EM Emoticon                 :) :(


## Development

#### Setup env

    npm install

then, in order to initialize the build process:

    mkdir build && gulp lexicon

#### Build

Next NLP requires `gulp` for the build process. Install it globally using `npm install -g gulp`.

Use `gulp` command to build and watch the source files for changes for live rebuild. Use `gulp -p` 

#### Test

Next NLP uses `nodeunit` for running the tests. Install it with `npm install nodeunit -g`. Use `nodeunit test/*.js` to run the tests.

## Milestones

#### Version 1

- ✔ Tokenization
- ✔ Part-of-Speech tagging
- ✔ Inflector (singularization, pluralization)
- ✔ Acronyms detection
- ✔ Negation detection
- o Profiling (sentiment, politeness, type of sentence)
    + ✔ Token scoring
    + ✔ Scoring consolidation
    + o Politeness
    + o Type of sentence
- o Tense detection
- o Dependency parsing
- o Example/demo page
- o Date extraction
- ✔ Entities extraction
    - o Proper nouns
    - o Hashtags
    - o @usernames, 
    - o IPs 
    - o Email address
    - o URL
- o Use a trie for lexicon querying on runtime

#### Version 2

- o Dynamic loading of lexicon, w/ versioning and cache using Application Cache
- o Use from a Web Worker (threaded processing)

